# Excel转换器

这个项目用于将通过WPS OCR识别的Excel文件转换为标准格式的多个Excel文件。

## 项目背景

- **输入**：通过WPS OCR识别PDF得到的Excel文件，包含大量合并单元格和边框信息
- **输出**：标准化的多个Excel文件（子目信息、含量表、工作内容_附注信息）
- **关键特点**：利用边框样式识别真实表格区域，保持数据完整性

## 文件结构

```
src/
├── types.ts          # 类型定义
├── excel-analyzer.ts # Excel文件分析器
├── data-extractor.ts # 数据提取器
├── file-exporter.ts  # 文件导出器
└── index.ts          # 主入口文件

sample/
├── input.xlsx        # 示例输入文件
└── output/           # 示例输出文件（CSV格式）
    ├── 附注信息.csv
    ├── 工作内容.csv
    ├── 子目信息.csv
    └── 含量表.csv
```

## 使用方法

### 1. 安装依赖

```bash
npm install
```

### 2. 运行转换脚本

```bash
npm start src/index.ts
```

或者使用tsx直接运行：

```bash
npx tsx src/index.ts
```

### 3. 检查输出

转换完成后，在 `output/` 目录下会生成两个子目录：

- `output/csv/` - CSV格式文件（用于调试验证）
- `output/excel/` - Excel格式文件（最终输出）

## 输出文件说明

### Excel格式输出

1. **工作内容_附注信息.xlsx** - 包含两个工作表：
   - 工作内容（编号，工作内容）
   - 附注信息（编号，附注信息）

2. **子目信息.xlsx** - 子目信息表：
   - 包含层级结构（用$符号表示）
   - 定额号、子目名称、基价、人工、材料、机械、管理费、利润等

3. **含量表.xlsx** - 材料含量表：
   - 编号、名称、规格、单位、单价、含量、主材标记等

### 数据格式

所有输出数据都严格按照 `src/types.ts` 中定义的接口格式进行结构化。

## 核心功能

### 1. 边框识别

- 利用Excel单元格的边框样式识别真实表格区域
- 处理OCR识别导致的合并单元格问题
- 自动分离不同的数据表格

### 2. 数据提取

- 智能识别四种数据类型：附注信息、工作内容、子目信息、含量表
- 处理层级结构（$, $$, $$$, $$$$标识）
- 数据类型自动转换和验证

### 3. 格式转换

- 支持CSV和Excel两种输出格式
- 保持数据完整性，严格按照原格式要求
- 自动处理特殊字符和编码问题

## 开发说明

### 主要类

- **ExcelAnalyzer**: 分析Excel文件结构，识别边框区域
- **DataExtractor**: 提取并结构化不同类型的数据
- **FileExporter**: 导出CSV和Excel格式文件

### 扩展说明

如果需要处理不同格式的输入文件，主要需要修改：

1. `excel-analyzer.ts` 中的区域识别逻辑
2. `data-extractor.ts` 中的数据解析规则
3. `types.ts` 中的数据结构定义

## 注意事项

- 确保输入文件路径正确（默认为 `sample/input.xlsx`）
- 转换过程中会在控制台显示详细的处理日志
- 如果识别效果不理想，可以调整边框识别的阈值参数
- 数据严格按照既定格式，不允许随意篡改

## 故障排除

如果转换失败，请检查：

1. 输入文件是否存在且格式正确
2. 文件是否包含预期的边框信息
3. 控制台输出的错误信息
4. 确保有足够的文件写入权限
